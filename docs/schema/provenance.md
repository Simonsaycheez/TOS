# Provenance Type Schema Reference
This section defines provenance-related data structures and optional response headers used to record and retrieve immutable audit information across OAP interactions.

  

Provenance structures extend the Common Envelope model but do not modify base transport semantics, headers, or identifiers.

  

This section introduces:

- optional provenance headers
    
- provenance event schemas
    
- provenance ledger/query envelopes
    
- incident event envelopes
    
- version registry envelopes
    

  

It does **not** prescribe governance rules, execution logic, or lifecycle behavior.

# **0 Optional Provenance HTTP Headers**

  

The following headers MAY be included on responses that produce provenance records.

They are optional surface indicators and do not control envelope function.
|**Header**|**Purpose**|
|---|---|
|Orch-Event-Hash|Hash identifier of the provenance event generated by the request|
|Orch-Prev-Event-Hash|Pointer to previous event hash in the same chain|
|Orch-Ledger-Anchor|Optional anchor reference to persistence layer (internal/external ledger)|

These headers:

- are not required at the base protocol level
    
- may be omitted depending on implementation or endpoint
    
- do not replace JSON payload data

# **1 Provenance Event Schema**

  

The following structure defines how a provenance event MAY be represented inside provenance envelopes or internal storage.
```
interface ProvEvent {
  event_id: OrchId;
  session_id?: OrchSessionId;
  trace_id?: OrchTraceId;

  timestamp: string;
  actor: string;
  module_id: string;
  envelope_type: string;

  input_ref?: object;
  output_ref?: object;

  policy_ref?: PolicyEventRef;
  risk?: string;
  status: "SUCCESS" | "ERROR";

  prev_event_hash?: string;
  event_hash: string;
  ledger_anchor?: string;

  meta?: object;
}
```

Notes:

- hash fields are internal provenance values; not required on protocol envelopes
    
- this section defines the object shape but not how hashing is computed
## **1.1 Policy Reference Subtype (Optional)**

```
interface PolicyEventRef {
  policy_binding_id: string;
  decision: string;
  constraints?: object[];
}
```

# **2 Provenance Ledger Envelope Types**

  

Ledger envelopes provide structured provenance retrieval.

They extend the common envelope structure through params/result only.

## **2.1 ledger.query**

  

### **Envelope Type**

  

provenance.ledger.query

  

#### **Params**
```
interface LedgerQueryParams {
  block_id?: string;
  event_hash?: string;
  merkle_root?: string;
  page?: OrchPageRequest;
}
```
#### **Result**

```
interface LedgerQueryResult {
  entries: LedgerEntry[];
  page?: OrchPageResponse<LedgerEntry>;
}
```

## **2.2 LedgerEntry Model**
```
interface LedgerEntry {
  block_id: string;
  timestamp: string;
  event_hashes: string[];
  merkle_root: string;
  anchor_hash?: string;
  block_metadata?: object;
}
```

This schema describes how a ledger block MAY be represented by retrieval envelopes.

# **3 Incident Ledger Envelope Types**

  

Incident envelopes support retrieval and review of records describing anomalies, model errors, and flagged risk cases.

  

They do not alter execution logic or enforce workflow ordering.

## **3.1 incident.query**

  

### **Envelope Type**

  

provenance.incident.query

  

#### **Params**
```
interface IncidentQueryParams {
  category?: string;
  severity?: string;
  date_range?: { from: string; to: string; };
  page?: OrchPageRequest;
}
```

#### **Result**

```
interface IncidentQueryResult {
  incidents: IncidentEvent[];
  page?: OrchPageResponse<IncidentEvent>;
}
```

## **3.2 IncidentEvent Model**
```
interface IncidentEvent {
  incident_id: string;
  event_id?: OrchId;
  timestamp: string;

  category: string;
  severity: string;

  actor?: string;
  module_id?: string;
  policy_binding_id?: string;

  description: string;

  evidence?: object;
  remediation?: IncidentRemediation;

  incident_hash: string;
  prev_incident_hash?: string;
}
```

## **3.3 IncidentRemediation Model (Optional)**

```
interface IncidentRemediation {
  recommended_action: string;
  applied_action?: string;
  approved_by?: string;
  timestamp?: string;
}
```

# **4 Artifact Registry Envelope Types (Versioned Knowledge Store)**

  

These envelopes support artifact lookup and registration. They do not enforce lifecycle rules.


## **4.1 artifact.register**

  

### **Envelope Type**

  

provenance.artifact.register

  

#### **Params**

```
interface ArtifactRegisterParams {
  metadata: ArtifactMetadata;
  payload_ref?: object;
}
```

#### **Result**

```
interface ArtifactRegisterResult {
  metadata: ArtifactMetadata;
}
```

## **4.2 artifact.get**

  

### **Envelope Type**

  

provenance.artifact.get

  

#### **Params**

```
interface ArtifactGetParams {
  artifact_id: string;
  version?: string;
}
```

#### **Result**

```
interface ArtifactGetResult {
  metadata: ArtifactMetadata;
  payload_ref?: object;
}
```

## **4.3 ArtifactMetadata Model**

```
interface ArtifactMetadata {
  artifact_id: string;
  type: string;
  name: string;
  version: string;
  previous_version?: string;

  created_at: string;
  created_by: string;

  checksum: string;
  description?: string;
}
```

# **5 Knowledge Change Envelope Types **

  

Knowledge change envelopes expose versioned updates.

No runtime governance logic is included here.

  

## **5.1 knowledge.change.query**

  

### **Envelope Type**

  

provenance.knowledge.change.query

  

#### **Params**
```
interface KnowledgeQueryParams {
  artifact_id?: string;
  status?: string;
  page?: OrchPageRequest;
}
```

#### **Result**

```
interface KnowledgeQueryResult {
  changes: KnowledgeChange[];
  page?: OrchPageResponse<KnowledgeChange>;
}
```

## **5.2 KnowledgeChange Model**
```
interface KnowledgeChange {
  change_id: string;
  artifact_id: string;
  version_before: string;
  version_after?: string;

  proposer: string;
  proposal: object;
  timestamp: string;

  status: string;

  reviewers?: string[];
  simulation_result?: object;
  approval_reason?: string;
  rollback_reason?: string;

  event_hash?: string;
}
```

# **6 Provenance Envelope Summary**
| **Envelope**                      | **Purpose**                          |
| --------------------------------- | ------------------------------------ |
| provenance.ledger.query           | Retrieve ledger block/event metadata |
| provenance.incident.query         | Retrieve anomaly/incident records    |
| provenance.artifact.register      | Register a new versioned artifact    |
| provenance.artifact.get           | Retrieve an artifact version         |
| provenance.knowledge.change.query | Query artifact evolution changes     |
